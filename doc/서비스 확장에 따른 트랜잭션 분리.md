## ì„œë¹„ìŠ¤ ê·œëª¨ê°€ í™•ì¥ë˜ì—ˆì„ ë•Œ ì„œë¹„ìŠ¤ ë¶„ë¦¬

![](https://velog.velcdn.com/images/wontaekoh/post/fc816d59-0ba4-4a4b-ba91-d35402d1fc73/image.png)

- ì„œë¹„ìŠ¤ ê·œëª¨ê°€ í™•ì¥ëœë‹¤ë©´ `MSA`ë¡œ êµ¬ì„±í•´ì•¼í•  ê²ƒì…ë‹ˆë‹¤. ì´ ë•Œ ë„ë©”ì¸ì„ ì ì ˆí•˜ê²Œ ë¶„ë¦¬í•˜ì—¬í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.
- ì €ëŠ” `ì£¼ë¬¸`, `ìƒí’ˆ`, `ì‚¬ìš©ì` 3ê°€ì§€ ë„ë©”ì¸ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì„¤ê³„í•˜ì˜€ìŠµë‹ˆë‹¤.
- ë¶€ê°€ì ì¸ ì„œë¹„ìŠ¤ë¡œ `Eureka Server`, `API Gateway`, `Config Server`, `ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤`ê°€ ìˆìŠµë‹ˆë‹¤.
  - `Eureka Server` : ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°€ ìì‹ ì„ ë“±ë¡í•˜ê³  ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë“¤ì„ ë°œê²¬í•˜ë„ë¡ ë•ëŠ” ì„œë¹„ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬.
  - `API Gateway` : í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ê° ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…í•˜ê³  ë¶€í•˜ ë¶„ì‚°, ì¸ì¦ ë“±ì˜ ê¸°ëŠ¥ì„ ì œê³µ.
  - `Config Server` : ëª¨ë“  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ ì„¤ì •ì„ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì„œë²„.
  - `ëª¨ë‹ˆí„°ë§` : í”„ë¡œë©”í…Œìš°ìŠ¤ + ê·¸ë¼íŒŒë‚˜ë¥¼ í™œìš©í•œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ.


## ğŸ“Œ ë¶„ì‚° íŠ¸ëœì­ì…˜: SAGA íŒ¨í„´ì˜ ì„ íƒ
- MSAì—ì„œëŠ” ë¶„ì‚° íŠ¸ëœì­ì…˜ì„ ì²˜ë¦¬í•  ë•Œ 2PC(Two-Phase Commit)ì™€ SAGA íŒ¨í„´ì„ ê³ ë ¤í•©ë‹ˆë‹¤.
- `2PC`: ê°•í•œ ì¼ê´€ì„±ì„ ë³´ì¥í•˜ì§€ë§Œ ë³µì¡ë„ê°€ ë†’ê³  ì„±ëŠ¥ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- `SAGA íŒ¨í„´`: ì„œë¹„ìŠ¤ ê°„ íŠ¸ëœì­ì…˜ì„ ì—°ì†ì ì¸ ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ ê´€ë¦¬í•˜ë©°, ì‹œìŠ¤í…œì˜ ìœ ì—°ì„±ê³¼ í™•ì¥ì„±ì„ ë†’ì´ëŠ” ë° ë” ì í•©í•©ë‹ˆë‹¤.
- ì´ëŸ¬í•œ ì´ìœ ë¡œ `SAGA íŒ¨í„´ì„ ì„ íƒ`í•˜ì—¬ íŠ¸ëœì­ì…˜ ê´€ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³ ì í•©ë‹ˆë‹¤.

## ğŸ“Œ Choreography vs Orchestration
- SAGA íŒ¨í„´ì˜ êµ¬í˜„ ë°©ì‹ì—ëŠ” `Choreography`ì™€ `Orchestration`ì´ ìˆìŠµë‹ˆë‹¤.
- `Choreography ë°©ì‹`: ê° ì„œë¹„ìŠ¤ê°€ ì´ë²¤íŠ¸ë¥¼ ì§ì ‘ ì²˜ë¦¬.
- `Orchestration ë°©ì‹`: ì¤‘ì•™ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ëª¨ë“  íŠ¸ëœì­ì…˜ ë‹¨ê³„ë¥¼ ì¡°ì •.
- ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” `ì„œë¹„ìŠ¤ ê°„ì˜ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³ ` `ìœ ì—°ì„±ì„ í™•ë³´`í•˜ê¸° ìœ„í•´ `Choreography ë°©ì‹ì„ ì±„íƒ`í•˜ì˜€ìŠµë‹ˆë‹¤.

## ğŸ“Œ ì•„ì›ƒë°•ìŠ¤ íŒ¨í„´ì˜ ì„ íƒ ì´ìœ 
- ì•„ì›ƒë°•ìŠ¤ íŒ¨í„´ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì´ë²¤íŠ¸ì™€ ë°ì´í„°ë¥¼ í•¨ê»˜ ì €ì¥í•˜ì—¬ ë°ì´í„° ì¼ê´€ì„±ì„ ìœ ì§€í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.
- ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ê°„ì˜ `ë¹„ë™ê¸° í†µì‹ ì„ êµ¬í˜„`í•  ë•Œ `ë°ì´í„° ì†ì‹¤`ì´ë‚˜ `ë¶ˆì¼ì¹˜ë¥¼ ë°©ì§€`í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë”°ë¼ì„œ ë°ì´í„° `ì¼ê´€ì„±`ê³¼ `ì•ˆì •ì„±`ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ `ì•„ì›ƒë°•ìŠ¤ íŒ¨í„´ì„ ì„ íƒ`í•˜ì˜€ìŠµë‹ˆë‹¤.

## ğŸ“Œ ì—ëŸ¬ë°œìƒì‹œ ë³´ìƒ íŠ¸ëœì­ì…˜

- MSA í™˜ê²½ì—ì„œëŠ” ê° ì„œë¹„ìŠ¤ê°€ ë…ë¦½ì ìœ¼ë¡œ ìš´ì˜ë˜ê¸° ë•Œë¬¸ì— `í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜`ìœ¼ë¡œ ëª¨ë“  ì‘ì—…ì„ `ê´€ë¦¬í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤`.
- ë”°ë¼ì„œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì§„í–‰í•˜ëŠ” ë„ì¤‘ `ì—ëŸ¬ê°€ ë°œìƒ`í•˜ë©´, ì´ë¯¸ ì§„í–‰ëœ ì‘ì—…ì„ ì›ë˜ ìƒíƒœë¡œ ë˜ëŒë¦¬ê¸° ìœ„í•´ `ë³´ìƒ íŠ¸ëœì­ì…˜`ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
- ë³´ìƒ íŠ¸ëœì­ì…˜ì€ `ì´ì „ì— ì„±ê³µí–ˆë˜ ì‘`ì—…ì„ `ì·¨ì†Œí•˜ëŠ” ë°©ì‹`ìœ¼ë¡œ, `ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€`í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ê°„ì˜ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ì— ëŒ€ë¹„í•˜ì—¬ ì „ì²´ í”„ë¡œì„¸ìŠ¤ê°€ ì¼ê´€ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```mermaid
graph TD
    A[ì£¼ë¬¸ ìš”ì²­] --> B[ì£¼ë¬¸, ê²°ì œ ìƒì„±]
    B --> C[ì œí’ˆ ì„œë¹„ìŠ¤ - ì¬ê³  ì°¨ê°]
    C -->|ì„±ê³µ| D[ì‚¬ìš©ì ì„œë¹„ìŠ¤ - í¬ì¸íŠ¸ ì°¨ê°]
    C -->|ì—ëŸ¬ ë°œìƒ| E[ë³´ìƒ íŠ¸ëœì­ì…˜ - ì£¼ë¬¸, ê²°ì œ ì‚­ì œ]
    D -->|ì„±ê³µ| F[ì£¼ë¬¸ ì™„ë£Œ]
    D -->|ì—ëŸ¬ ë°œìƒ| G[ë³´ìƒ íŠ¸ëœì­ì…˜ - ì œí’ˆ ì¬ê³  ì¦ê°€]
    G --> H[ë³´ìƒ íŠ¸ëœì­ì…˜ - ì£¼ë¬¸, ê²°ì œ ì‚­ì œ]

```

```mermaid
sequenceDiagram
    participant Client
    participant OrderService
    participant ProductService
    participant UserService

    Client->>OrderService: ì£¼ë¬¸ ìš”ì²­
    OrderService->>OrderService: ì£¼ë¬¸, ê²°ì œ ìƒì„±
    OrderService->>ProductService: ì¬ê³  ì°¨ê° ìš”ì²­
    ProductService-->>OrderService: ì„±ê³µ ì‹œ ì‘ë‹µ
    OrderService->>UserService: í¬ì¸íŠ¸ ì°¨ê° ìš”ì²­
    UserService-->>OrderService: ì„±ê³µ ì‹œ ì‘ë‹µ
    OrderService->>Client: ì£¼ë¬¸ ì™„ë£Œ

    ProductService-->>OrderService: ì¬ê³  ì°¨ê° ì‹¤íŒ¨ ì‹œ ì‘ë‹µ
    OrderService->>OrderService: ë³´ìƒ íŠ¸ëœì­ì…˜ - ì£¼ë¬¸, ê²°ì œ ì‚­ì œ
    OrderService->>Client: ì£¼ë¬¸ ì‹¤íŒ¨

    UserService-->>OrderService: í¬ì¸íŠ¸ ì°¨ê° ì‹¤íŒ¨ ì‹œ ì‘ë‹µ
    OrderService->>ProductService: ë³´ìƒ íŠ¸ëœì­ì…˜ - ì¬ê³  ì¦ê°€
    OrderService->>OrderService: ë³´ìƒ íŠ¸ëœì­ì…˜ - ì£¼ë¬¸, ê²°ì œ ì‚­ì œ
    OrderService->>Client: ì£¼ë¬¸ ì‹¤íŒ¨
```

